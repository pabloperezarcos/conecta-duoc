<app-navbar></app-navbar>

<div class="container mt-4">
    <app-breadcrumb></app-breadcrumb>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="titulo">Ayudant√≠as Acad√©micas</h2>
        <button class="btn btn-warning fw-bold" (click)="toggleFormulario()">
            <i class="fas fa-plus"></i>
            {{ mostrarFormulario ? 'Cancelar' : 'Publicar ayudant√≠a' }}
        </button>
    </div>

    <div *ngIf="!publicaciones.length" class="alert alert-info text-center">
        A√∫n no hay ayudant√≠as publicadas. S√© el primero en compartir una üí°
    </div>

    <form *ngIf="mostrarFormulario" (ngSubmit)="crearPublicacion()" [formGroup]="form" class="mb-4">
        <div class="mb-3">
            <label>T√≠tulo</label>
            <input formControlName="titulo" class="form-control" placeholder="Ej: Ayuda con matem√°ticas" />
        </div>

        <div class="mb-3">
            <label>Descripci√≥n</label>
            <textarea formControlName="descripcion" class="form-control" rows="4"
                placeholder="Detalle de la ayudant√≠a..."></textarea>
        </div>

        <button class="btn btn-warning" [disabled]="form.invalid">
            {{ publicacionEditando ? 'Guardar cambios' : 'Publicar' }}
        </button>

    </form>

    <div class="row g-4" *ngIf="publicaciones.length">
        <div class="col-12 col-md-6 col-lg-4" *ngFor="let pub of publicaciones">
            <div class="card shadow-sm h-100 ayudantia-card">

                <div class="card-body">
                    <h5 class="card-title">{{ pub.titulo }}</h5>
                    <p class="card-text text-muted">{{ pub.descripcion }}</p>

                    <div *ngIf="puedeEditar(pub)" class="text-end">
                        <button class="btn btn-sm btn-outline-secondary" (click)="editarPublicacion(pub)">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </div>
                </div>

                <div class="mt-3 border-top pt-2">
                    <div *ngFor="let com of pub.comentarios || []" class="comentarios mb-2 small">
                        <strong>{{ com.autor }}:</strong> {{ com.texto }}
                        <span class="text-muted ms-2">({{ com.fecha | date:'shortTime' }})</span>
                    </div>

                    <form (ngSubmit)="comentar(pub)" [formGroup]="comentarioForms[pub.id]">
                        <div class="input-group input-group-sm">
                            <input formControlName="texto" class="form-control"
                                placeholder="Escribe un comentario..." />
                            <button class="btn btn-outline-secondary" [disabled]="comentarioForms[pub.id].invalid">
                                Enviar
                            </button>
                        </div>
                    </form>
                </div>


                <div class="card-footer small text-muted d-flex justify-content-between">
                    <span><i class="fas fa-user"></i> {{ pub.autor }}</span>
                    <span><i class="fas fa-clock"></i> {{ pub.fecha | date:'shortDate' }}</span>
                </div>
            </div>
        </div>
    </div>



</div>